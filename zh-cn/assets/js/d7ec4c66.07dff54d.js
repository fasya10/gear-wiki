"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[5560],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(a),d=r,h=u["".concat(s,".").concat(d)]||u[d]||m[d]||l;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9917:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const l={sidebar_position:25},i="Tequila Train Game",o={unversionedId:"examples/tequila-train",id:"examples/tequila-train",title:"Tequila Train Game",description:"Tequila Train is a game similar to the Mexican Train game but has several differences in rules. Tequila Train involves a hub, trains, and tequila shots, with each player receiving between 4 to 8 tiles at the start. The game has a playable limit of 8 players using 91 tiles.",source:"@site/docs/examples/tequila-train.md",sourceDirName:"examples",slug:"/examples/tequila-train",permalink:"/zh-cn/docs/examples/tequila-train",draft:!1,editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/examples/tequila-train.md",tags:[],version:"current",sidebarPosition:25,frontMatter:{sidebar_position:25},sidebar:"docs",previous:{title:"Auto-subscription (VaraTube)",permalink:"/zh-cn/docs/examples/varatube"},next:{title:"IDEA \u7b80\u4ecb",permalink:"/zh-cn/docs/idea/idea-overview"}},s={},p=[{value:"Rules",id:"rules",level:2},{value:"How to run",id:"how-to-run",level:2},{value:"Build the smart contract",id:"build-the-smart-contract",level:3},{value:"Upload program and meta to the network",id:"upload-program-and-meta-to-the-network",level:3},{value:"Build and run user interface",id:"build-and-run-user-interface",level:3},{value:"Implementation details",id:"implementation-details",level:2},{value:"Source code",id:"source-code",level:2}],c={toc:p},u="wrapper";function m(e){let{components:t,...l}=e;return(0,r.kt)(u,(0,n.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"tequila-train-game"},"Tequila Train Game"),(0,r.kt)("p",null,"Tequila Train is a game similar to the Mexican Train game but has several differences in rules. Tequila Train involves a hub, trains, and tequila shots, with each player receiving between 4 to 8 tiles at the start. The game has a playable limit of 8 players using 91 tiles."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Tequila Train Game",src:a(5737).Z,width:"1996",height:"1148"})),(0,r.kt)("h2",{id:"rules"},"Rules"),(0,r.kt)("p",null,"Each player receives their dominoes, and the number of tiles they receive is automatically calculated based on the number of players."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"2...4 players: 8 tiles per each player"),(0,r.kt)("li",{parentName:"ul"},"5 players: 7 tiles per each player"),(0,r.kt)("li",{parentName:"ul"},"6 players: 6 tiles per each player"),(0,r.kt)("li",{parentName:"ul"},"7 players: 5 tiles per each player"),(0,r.kt)("li",{parentName:"ul"},"8 players: 4 tiles per each player")),(0,r.kt)("p",null,"Also, each player gets their own train differentiated by the color. Each player revise their tiles and see if they have matching dot numbers on both sides of one tile. 12 dots is the maximum number of each side. The player with the highest double places it in the center of the Tequila Train Hub. In case of nobody has a tile with matching numbers, each player will receive one additional tile, each player will continue receiving one additional tile till someone will receive the tile with the matching numbers on both sides."),(0,r.kt)("p",null,"The domino must be placed so that one end is touching the end of a domino already on the table and such that the end of the new domino matches (shows the same number of dots) the end of the domino it is adjacent to. Unless the tile is a double, the tile can be placed square in any one of the three directions as long as the two matching sides are touching fully."),(0,r.kt)("p",null,"First player only places the first tile (maximum double) and then the turn goes to the next player. If, in a later turn, the player draws a domino that enables them to start their train, they can only play this one domino. The player can remove their train but they are free to leave it as is (see below)."),(0,r.kt)("p",null,"If a player is unable to play and the boneyard is empty, the player must simply pass and ensure that a marker is placed upon their train."),(0,r.kt)("p",null,"In case if a player doesn\u2019t have a matching tile they put a train in their line and skip their turn. Since they have a train another player can put their tile in the line. For the next turn the player with the train can take additional tile from the tiles pool."),(0,r.kt)("p",null,"Anyone who wants to get their train back after playing a domino to their track should drink one shot of tequila or they will leave their train on the board."),(0,r.kt)("p",null,"The aim is to be the first player to get rid of all the dominoes in their hand. As soon as this happens, even if the last tile is a Double, the game ends."),(0,r.kt)("h2",{id:"how-to-run"},"How to run"),(0,r.kt)("p",null,"Source code can be found in the GitHub: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/tequila-train"},"https://github.com/gear-dapps/tequila-train")),(0,r.kt)("p",null,"Clone the repo and enter to the project directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/gear-dapps/tequila-train\ncd tequila-train\n")),(0,r.kt)("h3",{id:"build-the-smart-contract"},"Build the smart contract"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install Rust on your system using the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add specific toolchains using these commands:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"rustup toolchain add nightly\nrustup target add wasm32-unknown-unknown --toolchain nightly\n")),(0,r.kt)("p",{parentName:"li"},"Alternatively, you can run the following command to initialize the contracts:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"make init-contracts\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Build the contract using the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd contracts\ncargo build --release\n")),(0,r.kt)("p",{parentName:"li"},"Alternatively, you can run the following command to build the contract:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"make contracts\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Find the program binary ",(0,r.kt)("inlineCode",{parentName:"p"},"tequila_train.opt.wasm")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"contracts/target/wasm32-unknown-unknown/release")," directory, and the meta file ",(0,r.kt)("inlineCode",{parentName:"p"},"tequila_train.meta.txt")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"contracts")," directory."))),(0,r.kt)("h3",{id:"upload-program-and-meta-to-the-network"},"Upload program and meta to the network"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Go to ",(0,r.kt)("a",{parentName:"p",href:"https://idea.gear-tech.io/"},"https://idea.gear-tech.io/")," and choose ",(0,r.kt)("strong",{parentName:"p"},"Workshop")," node (",(0,r.kt)("inlineCode",{parentName:"p"},"wss://node-workshop.gear.rs"),").")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Upload the program binary Wasm ",(0,r.kt)("inlineCode",{parentName:"p"},"contracts/target/wasm32-unknown-unknown/release/tequila_train.opt.wasm")," and the meta file ",(0,r.kt)("inlineCode",{parentName:"p"},"contracts/tequila_train.meta.txt"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Use the list of players' IDs as a payload when initializing the program. For example, if you want to play on behalf of ",(0,r.kt)("strong",{parentName:"p"},"Alice")," (",(0,r.kt)("inlineCode",{parentName:"p"},"0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d"),") and ",(0,r.kt)("strong",{parentName:"p"},"Bob")," (",(0,r.kt)("inlineCode",{parentName:"p"},"0x8eaf04151687736326c9fea17e25fc5287613693c912909cb226aa4794f26a48"),"), you are to pass the following init payload:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'[\n    "0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d",\n    "0x8eaf04151687736326c9fea17e25fc5287613693c912909cb226aa4794f26a48"\n]\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy the program ID after successful uploading."))),(0,r.kt)("h3",{id:"build-and-run-user-interface"},"Build and run user interface"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install yarn on your system using the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"npm install --global yarn\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install the dependencies using the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yarn --cwd frontend\n")),(0,r.kt)("p",{parentName:"li"},"Alternatively, you can run the following command to install the dependencies:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"make init-frontend\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Change the program ID to the correct one obtained after uploading the program to the network (see previous steps) in ",(0,r.kt)("inlineCode",{parentName:"p"},"frontend/.env.example.local"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"REACT_APP_NODE_ADDRESS=wss://node-workshop.gear.rs\nREACT_APP_GAME_ADDRESS=0x3c1095f86e129b72fab05384bd9ff30bf32e155b5dd58a797ab8a4a941209a77\n")))),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Build the user interface using the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yarn --cwd frontend build\n")),(0,r.kt)("p",{parentName:"li"},"Alternatively, you can run the following command to build the user interface:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"make frontend\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Serve the user interface using the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yarn --cwd frontend start\n")),(0,r.kt)("p",{parentName:"li"},"Alternatively, you can run the following command to serve the user interface:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"make serve\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Once the user interface starts running, players can access the game by visiting the URL on the screen."))),(0,r.kt)("h2",{id:"implementation-details"},"Implementation details"),(0,r.kt)("p",null,"One user (he may be a player or not) uploads the game program and initializes it. Initialization data is a vector of players\u2019 public addresses:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust",metastring:'title="contracts/io/src/lib.rs"',title:'"contracts/io/src/lib.rs"'},"pub struct Players {\n    players: Vec<ActorId>,\n}\n")),(0,r.kt)("p",null,"Program makes all preparations during initialization."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Each player gets their dominoes; the tile count is calculated automatically depending on the player count."),(0,r.kt)("li",{parentName:"ol"},"The program tries to find the maximum double through users. If it doesn\u2019t, it adds one tile to each user and repeats this step until double has been found."),(0,r.kt)("li",{parentName:"ol"},"Program chooses the double and selects the first user.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust",metastring:'title="contracts/src/contract.rs"',title:'"contracts/src/contract.rs"'},'#[no_mangle]\nextern "C" fn init() {\n    let players_init: Players = msg::load().expect("Failed to decode `Players\'");\n\n    // All game initializing logic is inside GameState constructor\n    unsafe { GAME_STATE = GameState::new(&players_init) }\n}\n')),(0,r.kt)("p",null,"Every player move is the command message sent to the program:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Pass: skip the turn if there is no tile to place."),(0,r.kt)("li",{parentName:"ol"},"Turn: place selected tile to the selected track. Additionally, in certain circumstances the player may get their train back.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust",metastring:'title="contracts/io/src/lib.rs"',title:'"contracts/io/src/lib.rs"'},"/// Command to the program\npub enum Command {\n    Skip,\n    Place {\n        tile_id: u32,\n        track_id: u32,\n        remove_train: bool,\n    },\n}\n")),(0,r.kt)("p",null,"User interface gets the program state after every action and renders it in the browser."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust",metastring:'title="contracts/io/src/lib.rs"',title:'"contracts/io/src/lib.rs"'},"/// The whole game state\npub struct GameState {\n    pub players: Vec<ActorId>,\n    pub tracks: Vec<TrackData>,\n    pub shots: Vec<u32>,\n    pub start_tile: u32,\n    pub current_player: u32,\n    pub tile_to_player: BTreeMap<u32, u32>,\n    pub tiles: Vec<Tile>,\n    pub remaining_tiles: BTreeSet<u32>,\n    pub state: State,\n}\n\n/// Information about the player's track\npub struct TrackData {\n    pub tiles: Vec<Tile>,\n    pub has_train: bool,\n}\n\n/// Domino tile\npub struct Tile {\n    pub left: Face,\n    pub right: Face,\n}\n\n/// Tile's face (number of dots)\npub enum Face {\n    Zero,\n    One,\n    Two,\n    Three,\n    Four,\n    Five,\n    Six,\n    Seven,\n    Eight,\n    Nine,\n    Ten,\n    Eleven,\n    Twelve,\n}\n\n/// The state of the game\npub enum State {\n    Playing,\n    Stalled,\n    Winner(ActorId),\n}\n")),(0,r.kt)("h2",{id:"source-code"},"Source code"),(0,r.kt)("p",null,"The source code of the Tequila Train Game smart contract is available on ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/tequila-train"},"GitHub"),". They can be used as is or modified to suit your own scenarios."))}m.isMDXComponent=!0},5737:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/tequila-train-fa4af7eaaf9ff487c491077f3edaacf3.png"}}]);
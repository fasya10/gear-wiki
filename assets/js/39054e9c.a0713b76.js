"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[5593],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>b});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),c=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(a),m=n,b=u["".concat(l,".").concat(m)]||u[m]||d[m]||i;return a?r.createElement(b,o(o({ref:t},p),{},{components:a})):r.createElement(b,o({ref:t},p))}));function b(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:n,o[1]=s;for(var c=2;c<i;c++)o[c]=a[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},1558:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var r=a(7462),n=(a(7294),a(3905));const i={sidebar_label:"Auto-subscription (VaraTube)",sidebar_position:24},o="Decentralized subscription management and auto-renewal",s={unversionedId:"examples/varatube",id:"examples/varatube",title:"Decentralized subscription management and auto-renewal",description:"img alt",source:"@site/docs/examples/varatube.md",sourceDirName:"examples",slug:"/examples/varatube",permalink:"/docs/examples/varatube",draft:!1,editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/examples/varatube.md",tags:[],version:"current",sidebarPosition:24,frontMatter:{sidebar_label:"Auto-subscription (VaraTube)",sidebar_position:24},sidebar:"docs",previous:{title:"Decentralized DNS",permalink:"/docs/examples/dein"},next:{title:"Tequila Train Game",permalink:"/docs/examples/tequila-train"}},l={},c=[{value:"About",id:"about",level:2},{value:"Decentralization aspect",id:"decentralization-aspect",level:3},{value:"How to run",id:"how-to-run",level:2},{value:"\u2692\ufe0f Build program",id:"\ufe0f-build-program",level:3},{value:"\ud83c\udfd7\ufe0f Upload program",id:"\ufe0f-upload-program",level:3},{value:"\ud83d\udda5\ufe0f Run UI",id:"\ufe0f-run-ui",level:3},{value:"Program logic",id:"program-logic",level:2},{value:"Source code",id:"source-code",level:2}],p={toc:c},u="wrapper";function d(e){let{components:t,...i}=e;return(0,n.kt)(u,(0,r.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"decentralized-subscription-management-and-auto-renewal"},"Decentralized subscription management and auto-renewal"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"img alt",src:a(7250).Z,width:"1280",height:"812"})),(0,n.kt)("h2",{id:"about"},"About"),(0,n.kt)("p",null,"Many web services (in Web2) work on a subscription basis. One of the main features of subscription management is subscription auto-renewal. So that after the expiration of the subscription period, the money is automatically debited from the wallet and the subscription is automatically renewed without user intervention."),(0,n.kt)("p",null,"This dApp example represents a video-hosting service ",(0,n.kt)("strong",{parentName:"p"},(0,n.kt)("a",{parentName:"strong",href:"https://github.com/gear-dapps/varatube"},"VaraTube"))," that enables watching videos with a valid subscription that can be renewed automatically."),(0,n.kt)("h3",{id:"decentralization-aspect"},"Decentralization aspect"),(0,n.kt)("p",null,"In most blockchain networks, each transaction is invoked by a user or another program and must be completed in a single block (transactions are atomic). In general, a smart contract is able to invoke several functions, but only within a single block. In case of an error, the result of execution of all related functions is rolled back (the State does not change)."),(0,n.kt)("p",null,"According to the Actor Model in Gear Protocol, actors exchange messages. One of the Gear-specific entities is the Waitlist - a database where messages (not transactions) reside."),(0,n.kt)("p",null,"This makes it possible to implement logic when several logically related messages can be spaced apart in time. As a result, extrinsics that are caused by these messages can be executed in different blocks. It is possible for messages to stay in the Waitlist for a long time. This is achieved through ",(0,n.kt)("a",{parentName:"p",href:"/docs/developing-contracts/gas-reservation"},"Gas reservation")," for deferred messages. A program can send a ",(0,n.kt)("a",{parentName:"p",href:"/docs/developing-contracts/delayed-messages"},"delayed message")," to itself over as many blocks as it defines, provided there is enough reserved gas to be in the Waitlist."),(0,n.kt)("p",null,"State consistency between smart contracts is achieved using techniques described ",(0,n.kt)("a",{parentName:"p",href:"/docs/developing-contracts/distributed_transactions"},"here"),"."),(0,n.kt)("h2",{id:"how-to-run"},"How to run"),(0,n.kt)("h3",{id:"\ufe0f-build-program"},"\u2692\ufe0f Build program"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Get the source code of ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/gear-dapps/varatube/tree/master/src"},"VaraTube contract")," and ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/gear-dapps/fungible-token"},"Fungible Token contract")),(0,n.kt)("li",{parentName:"ul"},"Build contracts as described in ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/gear-dapps/varatube#readme"},"program/README.md"),".")),(0,n.kt)("h3",{id:"\ufe0f-upload-program"},"\ud83c\udfd7\ufe0f Upload program"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"You can deploy a program using ",(0,n.kt)("a",{parentName:"li",href:"https://idea.gear-tech.io/"},"idea.gear-tech.io")),(0,n.kt)("li",{parentName:"ol"},"In the network selector choose ",(0,n.kt)("inlineCode",{parentName:"li"},"Staging Testnet")," or ",(0,n.kt)("inlineCode",{parentName:"li"},"Development")," in case if you have running a local node"),(0,n.kt)("li",{parentName:"ol"},"Upload program ",(0,n.kt)("inlineCode",{parentName:"li"},"varatube.opt.wasm")," from ",(0,n.kt)("inlineCode",{parentName:"li"},"/target/wasm32-unknown-unknown/release/")),(0,n.kt)("li",{parentName:"ol"},"Upload metadata file ",(0,n.kt)("inlineCode",{parentName:"li"},"meta.txt")),(0,n.kt)("li",{parentName:"ol"},"Specify ",(0,n.kt)("inlineCode",{parentName:"li"},"init payload")," and calculate gas!"),(0,n.kt)("li",{parentName:"ol"},"Repeat steps #3-5 for uploading Fungible Token contract ",(0,n.kt)("inlineCode",{parentName:"li"},"fungible_token.opt.wasm"),"...")),(0,n.kt)("h3",{id:"\ufe0f-run-ui"},"\ud83d\udda5\ufe0f Run UI"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Install packages as described in ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/gear-dapps/varatube/tree/master/frontend#readme"},"frontend/README.md"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sh"},"yarn install\n")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"Create ",(0,n.kt)("inlineCode",{parentName:"li"},".env")," file, ",(0,n.kt)("inlineCode",{parentName:"li"},".env.example")," will let you know what variables are expected."),(0,n.kt)("li",{parentName:"ol"},"Configure ",(0,n.kt)("inlineCode",{parentName:"li"},".env")," file. Specify network address and program ID like in the example below:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sh"},"REACT_APP_NODE_ADDRESS=wss://rpc-node.gear-tech.io:443/\nREACT_APP_IPFS_GATEWAY_ADDRESS=https://ipfs.io/ipfs/\nREACT_APP_CONTRACT_ADDRESS=0x95e4b710736a53f4917194cc1a5122df7cf4b6e9d11652470a53a8cdc1ffe296\nREACT_APP_FT_CONTRACT_ADDRESS=0xa2677f49725647da5cff15e8a42b2ead9102c387d646ff856f586b81e4b598a0\n")),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"Run app")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sh"},"yarn start\n")),(0,n.kt)("h2",{id:"program-logic"},"Program logic"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"img alt",src:a(2129).Z,width:"320",height:"316"})),(0,n.kt)("p",null,"When a user purchases a subscription, access to the service is open, and after the subscription expires, access is closed."),(0,n.kt)("p",null,"The interface provides an option whether to enable or disable subscription auto-renewal. And if it is enabled, the subscription will be renewed automatically by getting funds from the user's. "),(0,n.kt)("p",null,"There is also an option to cancel the active subscription."),(0,n.kt)("p",null,"The VaraTube consists of two smart contracts:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/examples/gft-20"},"Gear Fungible Token (GFT-20)")," contract determines user and service balances required to purchase a subscription and approves Subscription contract to get funds from user's balance."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/gear-dapps/varatube#readme"},"VaraTube Subscription")," contract manages service's subscription - its availability, expiration, auto renewal.")),(0,n.kt)("h2",{id:"source-code"},"Source code"),(0,n.kt)("p",null,"The source code of the VaraTube smart contract including its testing as well as JS frontend web application example is available on ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/varatube"},"GitHub"),". They can be used as is or modified to suit your own scenarios."),(0,n.kt)("p",null,"For more details about testing smart contracts written on Gear, refer to the ",(0,n.kt)("a",{parentName:"p",href:"/docs/developing-contracts/testing"},"Program Testing")," article."))}d.isMDXComponent=!0},2129:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/enable-subscription-b3472300e77b07e4894e9c8b66fa1f9d.png"},7250:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/my-subscription-b2476b7bf69949ba8e999f9c65e688ae.jpg"}}]);